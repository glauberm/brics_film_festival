<?php

defined( 'ABSPATH' ) || die();

require_once get_template_directory() . '/forms/class-abstract-form.php';

class Contact_Form extends Abstract_Form {
	protected $route          = 'contact_form';
	protected $path           = '/pt/imprensa/';
	protected $email_template = ;

	protected function get_data( array $data ) : array {
		$data['name']    = sanitize_text_field( $_POST['name'] );
		$data['email']   = sanitize_email( $_POST['email'] );
		$data['subject'] = sanitize_text_field( $_POST['subject'] );
		$data['message'] = sanitize_text_field( $_POST['message'] );

		return $data;
	}

	protected function validate_fields( array $data ) : array {
		if ( empty( $_POST['name'] ) ) {
			$this->error_redirect( 'field_error' );
			return false;
		}

		if ( empty( $_POST['email'] ) ) {
			$this->error_redirect( 'field_error' );
			return false;
		}

		if ( empty( $_POST['subject'] ) ) {
			$this->error_redirect( 'field_error' );
			return false;
		}

		if ( empty( $_POST['message'] ) ) {
			$this->error_redirect( 'field_error' );
			return false;
		}

		return true;
	}

	protected function form_action( array $data ) {
		if ( ! wp_mail(
			CONTACT_FORM_TO,
			$data['subject'],
			$this->build_message(
				$data['subject'],
				$data['name'],
				$data['email'],
				$data['message']
			),
			[ 'Content-Type: text/html; charset=UTF-8' ]
		) ) {
			static::error_redirect( 'mail_error' );
		} else {
			static::success_redirect();
		}
	}

	private function build_message( $subject, $name, $email, $message ) {
		$body = require_once get_template_directory()
			. '/templates/emails/portuguese-contact-email.php';

		return require_once get_template_directory() . '/templates/email.php';
	}
}
